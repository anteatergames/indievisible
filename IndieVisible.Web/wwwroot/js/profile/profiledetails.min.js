var CONTENTACTIONS=function(){"use strict";function e(){o();s();h()}function o(){n.container=".content";n.btnShare=".btn-share";n.sharePopup=".share-popup";n.btnInteractionComment=".btn-interaction-comment";n.commentBox=".interaction-commentbox";n.commentTextArea=".commenttextarea";n.btnInteractionShare=".btn-interaction-share";n.sharePopup=".share-popup"}function s(){t.container=$(n.container)}function h(){c();l();a();v();y();i()}function c(){t.container.on("click",".btn-interaction-like",function(){var n=$(this),t=n.closest(".box-content").find(".like-count"),i=n.data("id");n.hasClass("like-liked")?b(i).done(function(i){k(i,t,n)}):p(i).done(function(i){w(i,t,n)})})}function l(){$(".content").on("click",n.btnInteractionComment,function(){var t=$(this),i=t.closest(".box-content").find(".box-commentsection"),r=t.closest(".box-content").find(n.commentBox),u=t.closest(".box-content").find(n.commentTextArea);i.is(":visible")?(i.addClass("d-none"),r.addClass("d-none")):(i.removeClass("d-none"),r.removeClass("d-none"),u.val("").focus())})}function a(){$(".content").on("keyup","textarea.commentbox",function(n){var i=$(this);if((n.keyCode===10||n.keyCode===13)&&n.ctrlKey){var t=i.closest(".interaction-commentbox").find(".commenttextarea"),o=t.data("url"),s=i.closest(".box-content").find(".comment-count"),h=t.data("usercontentid"),e=t.val().replace(/\n/g,"<br>\n"),c=t.data("usercontenttype");e.length>0&&r(o,h,e,c).done(function(n){u(n,s,t)})}f(this)})}function v(){$(".content").on("click",".btn-interaction-comment-send",function(){var i=$(this),n=i.closest(".interaction-commentbox").find(".commenttextarea"),f=n.data("url"),e=n.closest(".box-content"),o=e.find(".comment-count"),s=n.data("usercontentid"),t=n.val().replace(/\n/g,"<br>\n"),h=n.data("usercontenttype");t.length>0&&r(f,s,t,h).done(function(t){u(t,o,n)})})}function y(){t.container.on("click",n.btnShare,function(t){var u;t.preventDefault();$(n.sharePopup).fadeOut();var i=$(this).prop("href"),f=$(this).data("title"),r=$(this).data("provider");return i=encodeURI(i),r==="facebook"?FB.ui({method:"share",href:i},function(){}):r==="reddit"?(i="https://www.reddit.com/submit?title="+f+"&url="+i,window.open(i)):r==="twitter"?(u=$(this).data("text"),i="https://www.twitter.com/intent/tweet?text="+u+" "+i,window.open(i)):console.log(r),!1})}function i(){$(n.btnInteractionShare).each(function(t,i){var r=$(i),u=r.data();if(u.target){$(r).off("click");$(r).on("click",function(){console.log("clickshare");var t=$(u.target),i=r.position();t.css("top",i.top-80);t.on("mouseleave",function(){setTimeout(function(){t.is(":visible")&&t.fadeOut()},500)});$(n.sharePopup).fadeOut();t.is(":visible")?t.fadeOut():t.fadeIn()})}})}function p(n){return $.post("/content/like",{targetId:n})}function w(n,t,i){n.success===!0&&($(t).text(n.value),i.addClass("text-blue"),i.addClass("like-liked"))}function b(n){return $.post("/content/unlike",{targetId:n})}function k(n,t,i){n.success===!0&&($(t).text(n.value),i.removeClass("text-blue"),i.removeClass("like-liked"))}function r(n,t,i,r){return(n===null||n===undefined||n.length===0)&&(n="/content/comment"),$.post(n,{UserContentId:t,Text:i,UserContentType:r})}function u(n,t,i){var u,f,r,e,o;n.success===!0&&(u=i.closest(".interaction-commentbox"),f=i.val().replace(/\n/g,"<br>\n"),i.val(""),$(t).text(n.value),CONTENTACTIONS.AutosizeTextArea(i[0]),r=$(".box-comment-template").first().clone(),e=u.find("img").attr("src"),r.find("img").attr("src",e),r.find(".comment-authorname").text(u.data("fullname")),r.find(".comment-content").html(f),o=i.closest(".box-comments").find(".box-commentsection"),o.append(r.removeClass("d-none")))}function f(n){setTimeout(function(){n.style.cssText="height:auto;";n.style.cssText="height:"+(n.scrollHeight+2)+"px"},0)}var n={},t={};return{Init:e,AutosizeTextArea:f,BindShareContent:i}}(),POLLS;$(function(){CONTENTACTIONS.Init()});!function(n,t){"use strict";"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():n.Embedo=window.Embedo=t()}(this,function(){"use strict";function n(t){return this.options=t||n.defaults.OPTIONS,this.requests=[],this.events=[],this.init(this.options),this}function t(t,i,r,u){if(n.log("info","automagic",t,i,r),r=r||{},u=u||function(){},!n.utils.validateElement(t)||!n.utils.validateElement(i))return u(new Error("HTMLElement does not exist in DOM."));n.utils.watcher(r.id||n.utils.uuid(),function(){var f={width:r.width||n.utils.compute(t,"width"),height:r.height||n.utils.compute(t,"height")},e=n.utils.compute(i,"width"),o=n.utils.compute(i,"height"),s,h;if(r.strict)return u(null,{width:f.width,height:f.height});r.width&&r.height&&(s=f.width<e||f.height<o,(r.width&&(i.style.width=r.width+"px"),r.height&&(i.style.height=r.height+"px"),s)&&(h=Math.min(f.width/e,f.height/o),n.utils.transform(i,"scale("+h+")")));u(null,{width:f.width,height:f.height})},500)}function i(t,i){if(i=i||function(){},!n.defaults.SOURCES[t])return i(new Error("unsupported_sdk_type"));var r=0;!function u(){return 15<++r?i(new Error("sdk_not_available")):window[n.defaults.SOURCES[t].GLOBAL]?i(null,window[n.defaults.SOURCES[t].GLOBAL]):void setTimeout(u,10*r)}()}return n.log=function(t){n.debug&&"undefined"!=typeof console&&void 0!==console[t]&&console[t].apply(console,Array.prototype.slice.call(arguments,1))},n.defaults={OPTIONS:{facebook:null,twitter:!1,instagram:!1,pinterest:!1,googlemaps:null},SOURCES:{facebook:{GLOBAL:"FB",SDK:"https://connect.facebook.net/${locale}/all.js",oEmbed:"https://www.facebook.com/plugins/${type}/oembed.json",REGEX:/(?:(?:http|https):\/\/)?(?:www.)?facebook.com\/(?:(?:\w)*#!\/)?(?:pages\/)?([\w\-]*)?/g,PARAMS:{version:"v3.1",cookie:!0,appId:null,xfbml:!0}},twitter:{GLOBAL:"twttr",SDK:"https://platform.twitter.com/widgets.js",oEmbed:"https://publish.twitter.com/oembed",REGEX:/^http[s]*:\/\/[www.]*twitter(\.[a-z]+).*/i,PARAMS:{}},instagram:{GLOBAL:"instgrm",SDK:"https://platform.instagram.com/en_US/embeds.js",oEmbed:"https://api.instagram.com/oembed",REGEX:/instagram.com\/p\/[a-zA-Z0-9_\/\?\-\=]+/gi,PARAMS:{}},youtube:{GLOBAL:null,SDK:null,oEmbed:"https://www.youtube.com/embed/",REGEX:/^(?:(?:https?:)?\/\/)?(?:www\.)?(?:m\.)?(?:youtu(?:be)?\.com\/(?:v\/|embed\/|watch(?:\/|\?v=))|youtu\.be\/)((?:\w|-){11})(?:\S+)?$/,PARAMS:null},pinterest:{GLOBAL:"PinUtils",SDK:"https://assets.pinterest.com/js/pinit.js",oEmbed:null,REGEX:/(https?:\/\/(ww.)?)?pinterest(\.[a-z]+).*/i,PARAMS:{}},vimeo:{GLOBAL:null,SDK:null,oEmbed:"https://vimeo.com/api/oembed.json",REGEX:/(http|https)?:\/\/(www\.)?vimeo(\.[a-z]+)\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|)(\d+)(?:|\/\?)/,PARAMS:{}},googlemaps:{GLOBAL:"google",SDK:"https://maps.googleapis.com/maps/api/js",oEmbed:null,REGEX:/(http|https)?:\/\/(www\.|maps\.)?google(\.[a-z]+){1,2}\/maps\/.*/i,PARAMS:{}},github:{GLOBAL:null,SDK:null,oEmbed:null,REGEX:/https:\/\/gist\.github\.com\/(\w+)\/(\w+)/,PARAMS:{}},soundcloud:{GLOBAL:null,SDK:null,oEmbed:"https://soundcloud.com/oembed",REGEX:/^https:\/\/soundcloud\.com\/(\w+)\/.*$/,PARAMS:{}}},RESTRICTED:["url","strict","height","width","centerize","jsonp"]},n.utils=Object.create({uuid:function(){var n=46656*Math.random()|0,t=46656*Math.random()|0;return(n=("000"+n.toString(36)).slice(-3))+(t=("000"+t.toString(36)).slice(-3))},extend:function(n){var t,i;for(n=n||{},t=1;t<arguments.length;t++)if(arguments[t])for(i in arguments[t])arguments[t].hasOwnProperty(i)&&(n[i]=arguments[t][i]);return n},merge:function(n,t,i){for(var r in i=i||[],t)-1===i.indexOf(r)&&(n[r]=t[r]);return n},sequencer:function(){var n=arguments;return{then:function(t){function u(){++r===n.length&&t()}for(var r=0,i=0;i<n.length;i++)n[i](u)}}},replacer:function(n,t){if(n&&t){if(t)for(var i in t)n&&(n=n.split("${"+i+"}").join(t[i]));return n}},observer:function(){function n(){this.resolved=[];this.rejected=[]}return n.prototype={execute:function(n,t){var i=n.length;for(t=Array.prototype.slice.call(t);i--;)n[i].apply(null,t)},resolve:function(){this.execute(this.resolved,arguments)},reject:function(){this.execute(this.rejected,arguments)},done:function(n){return this.resolved.push(n),this},fail:function(n){return this.rejected.push(n),this}},n}(),validateURL:function(n){return/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(n)},generateElement:function(n,t){var i=document.createElement(n);return Object.keys(t||{}).forEach(function(n){i.setAttribute(n,t[n])}),i},generateEmbed:function(t,i,r){t=t||n.utils.uuid();var u=document.createElement("div");return u.setAttribute("id",t),u.setAttribute("data-embedo-id",t),u.setAttribute("data-embedo-source",i),n.utils.validateElement(r)?u.appendChild(r):u.innerHTML=r||"",u},generateScript:function(n){var t=document.createElement("script");return t.type="text/javascript",t.src=encodeURI(n),t.setAttribute("async",""),t.setAttribute("charset","utf-8"),t},validateElement:function(n){return"object"==typeof HTMLElement?n instanceof window.HTMLElement:n&&"object"==typeof n&&null!==n&&1===n.nodeType&&"string"==typeof n.nodeName},querystring:function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return i.join("&")},fetch:function(t,i,r){function o(n,t){try{delete window[n]}catch(t){window[n]=void 0}t&&(e.removeChild(t),t=void 0)}"function"==typeof i&&(r=i,i={});i=i||{};var e=document.head||document.getElementsByTagName("head")[0],u=document.createElement("script"),f="embedo_fetch_"+n.utils.uuid();t=(t+=(~t.indexOf("?")?"&":"?")+"callback="+encodeURIComponent(f)).replace("?&","?");window[f]=function(n){o(f,u);r(null,n)};u.type="text/javascript";u.defer=!0;u.charset="UTF-8";u.onerror=function(n){return o(f,u),r(n)};e.appendChild(u);u.src=t},ajax:function(n,t,i){"function"==typeof t&&(i=t,t={});i=i||function(){};var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE||4===r.readyState){if(400<=r.status)return i(new Error(r.responseText||r.statusText));try{return i(null,JSON.parse(r.responseText))}catch(n){return i(new Error("invalid_response"))}}};r.onerror=function(){return i(error)};r.open("GET",n);r.send()},transform:function(t,i){n.utils.validateElement(t)&&(t.style.webkitTransform=i,t.style.MozTransform=i,t.style.msTransform=i,t.style.OTransform=i,t.style.transform=i)},compute:function(t,i,r){if(n.utils.validateElement(t)&&i){var u=t.getBoundingClientRect()[i];return!r&&u||(document.defaultView&&document.defaultView.getComputedStyle?u=document.defaultView.getComputedStyle(t,"").getPropertyValue(i):t.currentStyle&&(i=i.replace(/\-(\w)/g,function(n,t){return t.toUpperCase()}),u=t.currentStyle[i])),"string"!=typeof u||/^\d+(\.\d+)?%$/.test(u)||(u=u.replace(/[^\d.-]/g,"")),isNaN(Number(u))?u:Number(u)}},convertToPx:function(t,i,r){var l,f,e,o,s,h,c,a,v,y,p,u,w;return isNaN(Number(r))?/^\d+(\.\d+)?%$/.test(r)?(y=t,p=i,u=r,w=n.utils.compute(y.parentNode,p,!0),u=parseFloat(u),w*(u/100)):r.match(/(vh|vw)/)?(l=r.replace(/[0-9]/g,""),f=l,e=r,o=window,s=document,h=s.documentElement,c=s.body,a=o.innerWidth||h.clientWidth||c.clientWidth,v=o.innerHeight||h.clientHeight||c.clientHeight,"vw"===f?a*parseFloat(e)/100:"vh"===f?v*parseFloat(e)/100:void 0):void 0:Number(r)},watcher:function(n,t,i){return window.EMBEDO_WATCHER=window.EMBEDO_WATCHER||{},window.EMBEDO_WATCHER[n]=window.EMBEDO_WATCHER[n]||{id:n,count:0,request:null},0<window.EMBEDO_WATCHER[n].count&&window.EMBEDO_WATCHER[n].request&&(window.EMBEDO_WATCHER[n].count-=1,clearTimeout(window.EMBEDO_WATCHER[n].request)),window.EMBEDO_WATCHER[n].count+=1,window.EMBEDO_WATCHER[n].request=setTimeout(function(){window.EMBEDO_WATCHER[n].count-=1;0===window.EMBEDO_WATCHER[n].count&&t.call()},i),null},dimensions:function(t,i,r){var u=n.utils.compute(t,"width");return{width:i=i||(0<u?u:n.utils.compute(t.parentNode,"width")),height:r=r||(0<u?u/1.5:n.utils.compute(t.parentNode,"height"))}},centerize:function(t,i,r){n.log("info","centerize",t,i,r);n.utils.validateElement(t)&&n.utils.validateElement(i)&&((r=r||{}).width&&(t.style.width=r.width,t.style.maxWidth=r.width,t.style.marginLeft="auto",t.style.marginRight="auto"),r.height&&(t.style.height=r.height,t.style.maxHeight=r.height),i.style.display="-moz-box",i.style.display="-ms-flexbox",i.style.display="-webkit-flex",i.style.display="-webkit-box",i.style.display="flex",i.style.textAlign="center",i.style["justify-content"]="center",i.style["align-items"]="center",i.style.margin="0 auto")},handleScriptValidation:function(n){if(n){n=n.split("#")[0];for(var t=document.getElementsByTagName("script"),i=t.length;i--;)if(t[i].src===n)return!0;return!1}}}),n.mixin=function(t){for(var r=["on","off","once","emit"],i=0;i<r.length;i++)t.prototype[r[i]]=n.prototype[r[i]]},(n.prototype=Object.create({on:function(n,t){"object"!=typeof this.events[n]&&(this.events[n]=[]);this.events[n].push(t)},off:function(n,t){var i;"object"==typeof this.events[n]&&-1<(i=this.events[n].indexOf(t))&&this.events[n].splice(i,1)},emit:function(n){var t,i,r,u=[].slice.call(arguments,1);if("object"==typeof this.events[n])for(r=(i=this.events[n].slice()).length,t=0;t<r;t++)i[t].apply(this,u)},once:function(n,t){this.on(n,function i(){this.off(n,i);t.apply(this,arguments)})}})).init=function(t){function i(t,i){if(t&&i){var r=n.utils.replacer(n.defaults.SOURCES[t.toLowerCase()].SDK,{locale:i.locale||window.navigator.language||"en_US"});n.utils.handleScriptValidation(r)||(i&&"object"==typeof i&&(r+=("facebook"===t?"#":"?")+n.utils.querystring(i)),document.body.appendChild(n.utils.generateScript(r)))}}n.log("info","init",this.requests,t);i("facebook",t.facebook);i("twitter",t.twitter);i("instagram",t.instagram);i("pinterest",t.pinterest);i("googlemaps",t.googlemaps)},n.prototype.facebook=function(r,u,f,e,o){function v(s){var c,h,l,a,v=n.utils.generateEmbed(r,"facebook",s);u.appendChild(v);c=u;h=v;l={id:r,url:f,strict:e.strict,width:e.width,height:e.height,centerize:e.centerize};a=function(n,t){if(n)return o(n);o(null,{id:r,el:u,width:t.width,height:t.height})};i("facebook",function(i){if(i)return a(i);window.FB.XFBML.parse(c);window.FB.Event.subscribe("xfbml.render",function(){h.firstChild&&(!1!==l.centerize&&n.utils.centerize(c,h,l),"rendered"===h.firstChild.getAttribute("fb-xfbml-state")&&t(c,h,l,a))})})}var s,h,l,a,c;(/^([^\/?].+\/)?post|photo(s|\.php)[\/?].*$/gm.test(f)?s=f.match(/comment_id|reply_comment_id/)?"comment":"post":/^([^\/?].+\/)?video(s|\.php)[\/?].*$/gm.test(f)&&(s="video"),s&&s.match(/post|video/))?(l=n.utils.replacer(n.defaults.SOURCES.facebook.oEmbed,{type:s}),a=n.utils.merge({url:encodeURI(f),omitscript:!0},e,n.defaults.RESTRICTED),("width"in e||"maxwidth"in e)&&(a.maxwidth=e.maxwidth||e.width),l+="?"+n.utils.querystring(a),n.utils.fetch(l,function(t,i){if(t)return n.log("error","facebook",t),o(t);v(i.html)})):("comment"===s||f.match(/comment_id|reply_comment_id/)?(h="fb-comment-embed",e["data-numposts"]=e["data-numposts"]||5):f.match(/plugins\/comments/)?h="fb-comments":(h="fb-page",e["data-height"]=e["data-height"]||e.maxheight||e.height||500),c=n.utils.generateElement("div",n.utils.merge({"class":h,"data-href":f,"data-width":e["data-width"]||e.maxwidth||e.width||350},e)),c.removeAttribute("width"),c.removeAttribute("height"),v(c))},n.prototype.twitter=function(r,u,f,e,o){var h=n.defaults.SOURCES.twitter.oEmbed,s=n.utils.merge({url:encodeURI(f),omit_script:1},e,n.defaults.RESTRICTED);("width"in e||"maxwidth"in e)&&(s.maxwidth=e.maxwidth||e.width);("height"in e||"maxheight"in e)&&(s.maxheight=e.maxheight||e.height);h+="?"+n.utils.querystring(s);n.utils.fetch(h,function(s,h){if(s)return n.log("error","twitter",s),o(s);var a,c,l,v,y=n.utils.generateEmbed(r,"twitter",h.html);u.appendChild(y);a=u;c=y;l={id:r,url:f,strict:e.strict,width:e.width,height:e.height,centerize:e.centerize};v=function(n,t){if(n)return o(n);o(null,{id:r,el:u,width:t.width,height:t.height})};i("twitter",function(i){if(i)return v(i);window.twttr.widgets.load(c);window.twttr.events.bind("rendered",function(i){c.firstChild&&c.firstChild.getAttribute("id")===i.target.getAttribute("id")&&(!1!==l.centerize&&n.utils.centerize(a,c,l),t(a,c,l,v))})})})},n.prototype.instagram=function(r,u,f,e,o){var s=n.defaults.SOURCES.instagram.oEmbed,h=n.utils.merge({url:encodeURI(f),omitscript:!0,hidecaption:!0},e,n.defaults.RESTRICTED),c;("width"in e||"maxwidth"in e)&&(e.width=e.maxwidth?e.maxwidth:e.width,320<e.width&&(h.maxwidth=e.width));s+="?"+n.utils.querystring(h);c=e.jsonp?"jsonp":"ajax";n.utils[c](s,function(s,h){if(s)return n.log("error","instagram",s),o(s);var v,c,l,a,y=n.utils.generateEmbed(r,"instagram",h.html);u.appendChild(y);v=u;c=y;l={id:r,url:f,strict:e.strict,width:e.width,height:e.height,centerize:e.centerize};a=function(n,t){if(n)return o(n);o(null,{id:r,el:u,width:t.width,height:t.height})};i("instagram",function(i){if(i)return a(i);if(!window.instgrm.Embeds||!window.instgrm.Embeds)return a(new Error("instagram_sdk_missing"));window.instgrm.Embeds.process(c);var r=setInterval(function(){if(c.firstChild&&c.firstChild.className.match(/instagram-media-rendered/))return clearInterval(r),!1!==l.centerize&&n.utils.centerize(v,c,l),t(v,c,l,a)},250)})})},n.prototype.youtube=function(t,i,r,u,f){function e(n){var t=n.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);return!(!t||2!==t.length)&&t[1]}if(!e(r))return n.log("error","youtube","Unable to detect Youtube video id."),f("Unable to detect Youtube video id.");var o=n.defaults.SOURCES.youtube.oEmbed+e(r)+"?"+n.utils.querystring(n.utils.merge({modestbranding:1,autohide:1,showinfo:0},u,n.defaults.RESTRICTED));this.iframe(t,i,o,u,f)},n.prototype.vimeo=function(t,i,r,u,f){var e=n.utils.dimensions(i,u.width,u.height),o=n.utils.merge({url:r,width:e.width,height:e.height,autohide:1},u,n.defaults.RESTRICTED),s=n.defaults.SOURCES.vimeo.oEmbed+"?"+n.utils.querystring(o);n.utils.fetch(s,function(r,u){if(r)return n.log("error","vimeo",r),f(r);var o=n.utils.generateEmbed(t,"vimeo",u.html);i.appendChild(o);f(null,{id:t,el:i,width:e.width,height:e.height})})},n.prototype.pinterest=function(r,u,f,e,o){var l,s,c,h,a=n.utils.dimensions(u,e.width,e.height),y=600<a.width?"large":a.width<345?"small":"medium",p=n.utils.generateElement("a",n.utils.merge({href:f,"data-pin-do":e["data-pin-do"]||"embedPin","data-pin-lang":e["data-pin-lang"]||"en","data-pin-width":y},e)),v=n.utils.generateEmbed(r,"pinterest",p);u.appendChild(v);l=u;s=v;c={id:r,url:f,strict:e.strict,width:e.width,height:e.height,centerize:e.centerize};h=function(t,i){if(t)return n.log("error","pinterest",t),o(t);o(null,{id:r,el:u,width:i.width,height:i.height})};i("pinterest",function(i){return i?h(i):window.PinUtils&&window.PinUtils&&s&&s.firstChild?void setTimeout(function(){s.querySelector("[data-pin-href]")||window.PinUtils.build(s);var i=0,r=setInterval(function(){return i+=1,s.querySelector("[data-pin-href]")?(clearInterval(r),!1!==c.centerize&&n.utils.centerize(l,s,c),t(l,s,c,h)):20<=i?(clearInterval(r),h(new Error("pinterest_embed_failed"))):void 0},250)},750):h(new Error("pinterest_sdk_missing"))})},n.prototype.googlemaps=function(t,r,u,f,e){var s,h=n.utils.dimensions(r,f.width,f.height),v=(s=u.match(/@(-?\d+\.\d+),(-?\d+\.\d+),(\d+\.?\d?)+z/))&&s.length&&s[1]&&s[2]?{lat:parseFloat(s[1],0),lng:parseFloat(s[2],0)}:null,c,l,o,y,a;if(!v)return e(new Error("unable_to_find_cordinates"));a=n.utils.generateEmbed(t,"googlemaps");r.appendChild(a);c=r;l=a;o={url:u,width:h.width,height:h.height,centerize:f.centerize};y=function(i){if(i)return n.log("error","googlemaps",i),e(i);var u=new window.google.maps.LatLng(v.lat,v.lng),o=new window.google.maps.Map(a,{zoom:f.zoom||12,center:u,mapTypeId:f.MapTypeId||window.google.maps.MapTypeId.ROADMAP}),s=new window.google.maps.Marker({map:o,draggable:!0,animation:window.google.maps.Animation.DROP,position:u});e(null,{id:t,el:r,width:h.width,height:h.height,marker:s})};i("googlemaps",function(t){if(t)return y(t);!1!==o.centerize&&n.utils.centerize(c,l,o);l.style.width=o.width?o.width+"px":n.utils.compute(c,"width");l.style.height=o.height?o.height+"px":n.utils.compute(c,"height");y(null,{})})},n.prototype.github=function(t,i,r,u,f){var s=n.utils.dimensions(i,u.width,u.height),e=n.utils.generateElement("iframe",n.utils.merge({width:s.width,height:s.height},u,n.defaults.RESTRICTED)),o=n.utils.generateEmbed(t,"github",e);i.appendChild(o);e.contentWindow.document.open();e.contentWindow.document.write('<body><style type="text/css">body,html{margin:0;padding:0;border-radius:3px;}.gist .gist-file{margin:0 !important;padding:0;}<\/style><script src="'+r+'"><\/script><\/body>');e.contentWindow.document.close();e.onerror=function(n){f(n)};e.onload=function(){f(null,{id:t,el:i,width:n.utils.compute(o,"width"),height:n.utils.compute(o,"height")})}},n.prototype.soundcloud=function(t,i,r,u,f){u.hasOwnProperty("width")&&u.width&&(u.maxwidth=u.maxwidth||u.width||"100%");u.hasOwnProperty("height")&&u.height&&(u.maxheight=u.maxheight||u.height);var e=n.utils.dimensions(i,u.maxwidth,u.maxheight),o=n.utils.merge({url:encodeURI(r),format:"js"},u,n.defaults.RESTRICTED),s=n.defaults.SOURCES.soundcloud.oEmbed+"?"+n.utils.querystring(o);n.utils.fetch(s,function(r,u){if(r)return n.log("error","soundcloud",r),f(r);var o=n.utils.generateEmbed(t,"soundcloud",u.html);i.appendChild(o);f(null,{id:t,el:i,width:e.width,height:e.height})})},n.prototype.iframe=function(t,i,r,u,f){var o=document.createDocumentFragment(),s=n.utils.dimensions(i,u.width,u.height),h=(r.substr(r.lastIndexOf("."))||"").replace(".","").toLowerCase(),c={csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",pdf:"application/pdf",gif:"image/gif",js:"application/javascript",json:"application/json",xhtml:"application/xhtml+xml",pps:"application/vnd.ms-powerpoint",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",xml:"application/xml",ogg:"video/ogg",mp4:"video/mp4",webm:"video/webm",html:"text/html"},a=c[h]||c.html,l=h.match(/(mp4|ogg|webm|ogv|ogm)/)?"video":u.tagName||"embed",v=n.utils.merge({},u,n.defaults.RESTRICTED),e=n.utils.generateElement(l,n.utils.merge({type:a,src:r,width:s.width,height:s.height},v));o.appendChild(n.utils.generateEmbed(t,"iframe",e));i.appendChild(o);"video"===l?setTimeout(function(){f(null,{id:t,el:i,width:n.utils.compute(e,"width"),height:n.utils.compute(e,"height")})},250):(e.onerror=function(n){f(n)},e.onload=function(){f(null,{id:t,el:i,width:n.utils.compute(e,"width"),height:n.utils.compute(e,"height")})})},n.prototype.render=function(t,i,r,u){var e,o,f;if(n.log("info","render",t,i,r),r=r||{},u=u||function(){},!t||!n.utils.validateElement(t))return n.log("info","render","`element` is either missing or invalid"),this.emit("error",new Error("element_is_missing"));if("string"!=typeof i)return this.emit("error",new Error("invalid_url_string"));if(!i||!n.utils.validateURL(i))return n.log("info","render","`url` is either missing or invalid"),this.emit("error",new Error("invalid_or_missing_url"));if(e=function(t){var r=Object.keys(n.defaults.SOURCES)||[],i;return/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(t)?(i=r.filter(function(i){if(n.defaults.SOURCES[i]&&t.match(n.defaults.SOURCES[i].REGEX))return i}).filter(Boolean),i&&i.length?i[0]:"iframe"):null}(i),!e)return n.log("info","render",new Error("Invalid or Unsupported URL")),this.emit("error",new Error("url_not_supported"));if(!this[e])return n.log("info","render",new Error("Requested source is not implemented or missing.")),this.emit("error",new Error("unrecognised_url"));"width"in r&&r.width&&(r.width=n.utils.convertToPx(t,"width",r.width));"height"in r&&r.height&&(r.height=n.utils.convertToPx(t,"height",r.height));o=n.utils.uuid();f={id:o,el:t,source:e,url:i,attributes:r};this.requests.push(f);this.emit("watch","load",f);this[e](o,t,i,r,function(n,t){if(n)return this.emit("error",n),u(n);t.url=f.url;t.source=f.source;t.options=f.attributes;this.emit("watch","loaded",t);u(null,t)}.bind(this))},n.prototype.load=function(t,i,r){var u,f,e;return n.log("info","load",t,i,r),r=r||{},u=new n.utils.observer,t&&n.utils.validateElement(t)?i instanceof Array?(f={failed:[],finished:[]},e=i.map(function(n){return function(i){this.render(t,n,r,function(n,t){if(n)return f.failed.push(n),i(n);f.finished.push(t);i(null,t)})}.bind(this)}.bind(this)),n.utils.sequencer.apply(this,e).then(function(){if(0<f.failed.length)return u.reject(f.failed);u.resolve(f.finished)})):"string"==typeof i?this.render(t,i,r,function(n,t){if(n)return u.reject(n);u.resolve(t)}):this.emit("error",new Error("invalid_url_string")):(n.log("info","load","`element` is either missing or invalid"),this.emit("error",new Error("element_is_missing"))),u},n.prototype.refresh=function(i){if(n.log("info","refresh",this.requests,i),0!==this.requests.length)return this.requests.forEach(function(r){if(r.el){if("iframe"===r.source||"googlemaps"===r.source)return this.emit("refresh",r,{width:n.utils.compute(r.el,"width"),height:n.utils.compute(r.el,"height")});if(i){if(!n.utils.validateElement(i))return;i===r.el&&t(r.el,document.getElementById(r.id),r.attributes,function(n,t){t&&this.emit("refresh",r,t)}.bind(this))}else t(r.el,document.getElementById(r.id),r.attributes,function(n,t){t&&this.emit("refresh",r,t)}.bind(this))}}.bind(this)),this},n.prototype.destroy=function(t){if(n.log("warn","destroy",this.requests,t),0!==this.requests.length){var i=[];return this.requests.forEach(function(r){if(r.el&&n.utils.validateElement(r.el))if(t){if(!n.utils.validateElement(t))return;t===r.el&&(document.getElementById(r.id)&&document.getElementById(r.id).remove(),i.push(r.id),this.emit("destroy",r))}else document.getElementById(r.id)&&document.getElementById(r.id).remove(),i.push(r.id),this.emit("destroy",r)}.bind(this)),this.requests=this.requests.filter(function(n){return i.indexOf(n.id)<0}),this}},n});POLLS=function(){"use strict";function t(){i();r()}function i(){n.divPostPoll=$("div#divPostPoll");n.options=$("input.polloptioninput")}function r(){u();f();e()}function u(){$(".content").on("click","#btnAddOption",function(){var u=n.divPostPoll.children(".polloption:first"),t=u.clone(),i=t.children(".polloptioninput"),r;i.val("");r=t.find(".btn-option-remove");$(r).removeClass("invisible");t.insertBefore("#btnAddOption");t.addClass("polloptionextra");i.focus();POLLS.Events.PostAddOption()})}function f(){$(".content").on("click",".btn-option-remove",function(){var n=$(this).closest(".polloption");n.remove();POLLS.Events.PostAddOption()})}function e(){$(".content").on("click","ul.poll.canvote li input.poll-option",function(){var n=$(this);s(n.val()).done(function(t){h(t,n)})})}function o(){n.options.val("");$(".polloptionextra").remove()}function s(n){return $.post("/interact/poll/vote",{pollOptionId:n}).done(function(n){n.success&&MAINMODULE.Common.HandlePointsEarned(n)})}function h(n,t){var u,e,i;if(n.success===!0){var r=t.closest("ul.poll"),s=r.closest(".poll-wrapper"),h=s.find(".poll-vote-count"),c=r.children("li");for($(c).each(function(){var n=$(this);n.removeClass("voted").addClass("notvoted");var t=n.children("span.perc-back"),i=n.children("span.perc-number"),r=n.find("input");t.css("width","0");i.text("0.00%");r.prop("checked",!1)}),u=$(t).parent("li"),u.removeClass("notvoted").addClass("voted"),e=u.find("input"),e.prop("checked",!0),i=0;i<n.value.optionResults.length;i++){var f=n.value.optionResults[i],l=r.find(`input[value="${f.optionId}"]`),o=l.parent("li"),a=o.children("span.perc-back"),v=o.children("span.perc-number");a.css("width",f.percentage+"%");v.text(f.percentage+"%")}h.text(n.value.totalVotes)}}var n={};return{Init:t,Methods:{ClearOptions:o},Events:{PostAddOption:function(){}}}}();$(function(){POLLS.Init()});var FEEDTYPE={HOME:1,USER:2,GAME:3,ARTICLES:4},ACTIVITYFEED=function(){"use strict";function e(u,f,e){r=f;i=e;n.divActivityFeed=u;t.btnMorePosts="#btnMorePosts";t.btnDeletePost=".btnDeletePost";n.btnInteractionShare=".btn-interaction-share";n.sharePopup=".share-popup";o()}function o(){s();h()}function s(){$("body").on("click",t.btnMorePosts,function(){var n=$(this);u=n.data("oldestid");f=n.data("oldestdate");MAINMODULE.Common.DisableButton(n);ACTIVITYFEED.Methods.LoadActivityFeed(!1)})}function h(){$("body").on("click",t.btnDeletePost,function(n){n.preventDefault();var t=$(this),i=t.data("id"),r=t.data("confirmationmessage"),u=t.data("confirmationtitle"),f=t.data("confirmationbuttontext"),e=t.data("cancelbuttontext");return ALERTSYSTEM.ShowConfirmMessage(u,r,f,e,function(){$.ajax({url:"/content/"+i,type:"DELETE"}).done(function(n){if(n.success){var i=t.closest(".box-content");i.remove();n.message&&ALERTSYSTEM.ShowSuccessMessage(n.message)}else ALERTSYSTEM.ShowWarningMessage(n.message)})}),!1})}function c(e,o){e!==!1&&n.divActivityFeed.append(MAINMODULE.Default.Spinner);var s="/content/feed?load=1";i&&r===FEEDTYPE.USER&&(s+="&userId="+i);i&&r===FEEDTYPE.GAME&&(s+="&gameId="+i);r===FEEDTYPE.ARTICLES&&(s+="&articlesOnly=True");u&&(s+="&oldestId="+u);f&&(s+="&oldestDate="+f);$.get(s,function(i){f!==undefined&&u!==undefined?(n.divActivityFeed.find(".spinner").remove(),$(t.btnMorePosts).parent().remove(),n.divActivityFeed.append(i)):n.divActivityFeed.html(i);CONTENTACTIONS.BindShareContent();l();o&&o()})}function l(){if(typeof Embedo=="function"){var n=new Embedo({youtube:!0,facebook:{appId:$('meta[property="fb:app_id"]').attr("content"),version:"v3.2",width:"100%"}}),t=$("oembed");t.each(function(t,i){var r=$(i).closest(".videoWrapper"),u,f;r.hasClass("loaded")||($(i).find("embed").hide(),u=r.width(),f=u*9/16,n.load(i,i.innerHTML,{width:u,height:f,centerize:!0,strict:!1}).done(function(){r.addClass("loaded")}))})}}var n={},t={},r,i,u,f;return{Init:e,Methods:{LoadActivityFeed:c},Events:{}}}(),PROFILEDETAILS=function(){"use strict";function r(){u();f();e();v(n.Id.val());ft();ACTIVITYFEED.Init(n.divActivityFeed,FEEDTYPE.USER,n.Id.val())}function u(){t.content=".content";t.divListUserTeams="#divListUserTeams";t.tabActivity="#tabactivity";t.divActivityFeed="#tabactivity #divActivityFeed";t.tabGames="#tabgames";t.tabGamesContainer="#tabgamescontainer";t.tabConnections="#tabconnections";t.Id="#Id";t.UserId="#UserId";t.divBadges="#divBadges"}function f(){n.content=$(t.content);n.divListUserTeams=$(t.divListUserTeams);n.tabActivity=$(t.tabActivity);n.divActivityFeed=$(t.divActivityFeed);n.tabGames=$(t.tabGames);n.tabGamesContainer=$(t.tabGamesContainer);n.tabConnections=$(t.tabConnections);n.Id=$(t.Id);n.UserId=$(t.UserId);n.divBadges=$(t.divBadges)}function e(){o();s();h();c();l()}function o(){n.content.on("click","#btn-profile-follow",function(){var n=$(this),t=n.closest(".user-profile").find(".follow-count"),i=n.data("id");n.hasClass("btn-follow-following")?w(i).done(function(i){b(i,t,n)}):y(i).done(function(i){p(i,t,n)})})}function s(){n.content.on("click","#btn-profile-connect",function(){var n=$(this),t=n.closest(".user-profile").find(".connection-count"),i=n.data("id");n.hasClass("disabled")||(n.hasClass("btn-connect-connected")?g(i).done(function(i){nt(i,t,n)}):k(i).done(function(i){d(i,t,n)}))})}function h(){n.content.on("click","#btn-profile-connect-allow",function(){var n=$(this),t=$("#btn-profile-connect"),i=n.closest(".user-profile").find(".connection-count"),r=n.data("id");tt(r).done(function(n){it(n,i,t)})})}function c(){n.content.on("click","#btn-profile-connect-deny",function(){var n=$(this),t=$("#btn-profile-connect"),i=n.closest(".user-profile").find(".connection-count"),r=n.data("id");rt(r).done(function(n){ut(n,i,t)})})}function l(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){t.preventDefault();var r=t.target.getAttribute("href");return r==="#"+n.tabActivity.prop("id")?ACTIVITYFEED.Methods.LoadActivityFeed():r==="#"+n.tabGames.prop("id")?a(n.Id.val()):r==="#"+n.tabConnections.prop("id")&&i(n.UserId.val()),!1})}function a(t){n.tabGamesContainer.html(MAINMODULE.Default.Spinner);$.get("/game/latest?userId="+t,function(t){n.tabGamesContainer.html(t)})}function v(t){n.divBadges.html(MAINMODULE.Default.Spinner);$.get("/gamification/userbadge/list/"+t,function(t){n.divBadges.html(t)})}function i(t){n.tabConnections.html(MAINMODULE.Default.Spinner);$.get("/user/connections/"+t,function(t){n.tabConnections.html(t)})}function y(n){return $.post("/user/follow",{userId:n})}function p(n,t,i){n.success===!0?($(t).text(n.value),i.addClass("btn-follow-following")):ALERTSYSTEM.ShowWarningMessage(n.message)}function w(n){return $.post("/user/unfollow",{userId:n})}function b(n,t,i){n.success===!0?($(t).text(n.value),i.removeClass("btn-follow-following")):ALERTSYSTEM.ShowWarningMessage(n.message)}function k(n){return $.post("/user/connect",{userId:n})}function d(n,t,i){if(n.success===!0){var r=i.data("textPending");i.text(r);i.addClass("disabled")}else ALERTSYSTEM.ShowWarningMessage(n.message)}function g(n){return $.post("/user/disconnect",{userId:n})}function nt(n,t,i){n.success===!0?($(t).text(n.value),i.removeClass("btn-connect-connected"),i.text(i.data("textConnect"))):ALERTSYSTEM.ShowWarningMessage(n.message)}function tt(n){return $.post("/user/allowconnection",{userId:n})}function it(t,r,u){t.success===!0?($(r).text(t.value),$(".connectionalertbox").hide(),u.addClass("btn-connect-connected"),u.removeClass("disabled"),u.text(u.data("textConnected")),i(n.UserId.val())):ALERTSYSTEM.ShowWarningMessage(t.message)}function rt(n){return $.post("/user/denyconnection",{userId:n})}function ut(n,t,i){n.success===!0?($(t).text(n.value),$(".connectionalertbox").hide(),i.removeClass("disabled"),i.text(i.data("textConnect"))):ALERTSYSTEM.ShowWarningMessage(n.message)}function ft(){n.divListUserTeams.html(MAINMODULE.Default.SpinnerTop);console.log(n.divListUserTeams);$.get("/team/list/user/"+n.UserId.val(),function(t){n.divListUserTeams.html(t)}).done(function(){et()})}function et(){$("[data-toggle='popover']").each(function(n,t){var i=$(t).data(),r,u;i.target&&(r=i.target,u=$(r).html(),i.content=u,i.html=!0);$(t).popover(i)})}var t={},n={};return{Init:r}}();$(function(){PROFILEDETAILS.Init()});